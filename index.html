<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watersheds Mod Configuration</title>
    <link rel="stylesheet" href="css/styles.css">
    <script>
        // Apply saved theme immediately to prevent flash
        (function() {
            const saved = localStorage.getItem('theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
            }
        })();
    </script>
</head>
<body>
    <header>
        <h1>Watersheds Mod Configuration</h1>
        <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
            <span class="icon-sun">&#9728;</span>
            <span class="icon-moon">&#9790;</span>
        </button>
    </header>

    <main>
        <div id="loading">Loading configuration data...</div>
        <div id="error" style="display: none;"></div>

        <div class="intro-note">
            Adjusting these configs was the most time consuming part of developing this mod.<br>
            I hope you can improve the shape of the streams, particularly with the braiding and meandering.<br>
            You can test and compare changes to these configs ingame with <strong>/watersheds testconfigchange</strong> then regenerating the terrain.<br>
            For some configs you'll need to run <strong>/watersheds clearstreammaps</strong> to regenerate a fresh stream map with your new config changes when you regen the terrain.<br>
            Let me know if you think you've improved the default configs in any way at all.<br><br>
            I also need fresh ideas on how to improve the water, the terrain noise carving, and the stream mouths.<br>
            With the mouths, I need ideas for ways to get braiding and meandering working on the paths near the mouths without breaking the connection to the water.
    <div style="margin-top: 8px;"><strong>Contacts:</strong><br>Discord: algernon733 | Email: algernon733@gmail.com</div>
</div>

        <div id="advanced-warning" class="advanced-warning">
            Many of these config values are very volatile.<br>
            When editing the configs keep in mind you could cause errors, cause poor performance, or ruin some rare edge cases of streams.<br>
            Make sure you fly around the world and check atleast around 3000 square blocks (like square meters) worth of terrain before playing with your changes.<br>
            Don't change things you don't understand and therefore can't test, unless you want to risk playing on a world with hidden issues that could come up halfway through your playthrough.
        </div>

        <div id="preset-bar" style="display: none;">
            <label for="preset-select">Preset:</label>
            <select id="preset-select">
                <option value="default">Safe Fast Simple Boring Streams (default)</option>
            </select>
        </div>

        <div id="config-container">
            <!-- Accordions generated by JavaScript -->
        </div>

        <div id="actions" style="display: none;">
            <label class="advanced-toggle">
                <input type="checkbox" id="show-advanced">
                <span>Show Advanced Settings</span>
            </label>
            <button id="reset-all" type="button">Reset All to Defaults</button>
            <button id="download-config" type="button">Download Config Files</button>
        </div>

        <div id="download-instructions" style="display: none;">
            <p>Extract the downloaded zip file to your ModConfig folder:</p>
            <code>%AppData%\VintagestoryData\ModConfig\</code>
            <p>You should then have a folder like this: <strong>VintagestoryData\ModConfig\Watersheds</strong> that contains your custom configuration.</p>
        </div>
    </main>

    <script src="lib/jszip.min.js"></script>
    <script src="js/app.js" type="module"></script>
    <script>
        // Theme toggle functionality
        document.getElementById('theme-toggle').addEventListener('click', function() {
            const root = document.documentElement;
            const current = root.getAttribute('data-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            let newTheme;
            if (current === 'dark') {
                newTheme = 'light';
            } else if (current === 'light') {
                newTheme = 'dark';
            } else {
                // No explicit theme set, toggle from system preference
                newTheme = prefersDark ? 'light' : 'dark';
            }

            root.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
    </script>
</body>
</html>
